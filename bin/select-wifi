#!/usr/bin/env bash

if [ $# = 0 ]; then
    alacritty --title='~#floating#~' -e select-wifi 1
    exit
fi

nmcli device wifi rescan
wifis="$(nmcli device wifi list)"

fzf_args="--color=16,hl:#ffcb6b,hl+:#89ddff,fg+:#ffffff,pointer:#89ddff"
ssid="$(echo "$wifis" | tail -n +2 | sed '/^\*/d' | fzf --no-info $fzf_args | awk '{print $2}')"

[ -z "$ssid" ] && exit

read -p "with passphrase? y/n: " with_pass
if [ "$with_pass" = "y" ]; then
    read -p "passphrase: " passphrase
    [ -z "$passphrase" ] && exit

    sudo nmcli device wifi connect "$ssid" password "$passphrase"
else
    sudo nmcli device wifi connect "$ssid"
fi
